%!TEX root = ../Peerbox.tex



\subsection{Middleware}
communication between peers via multicast 

however ip multicast is per se unreliable, early test have shown a miss rate of 20\%

negative acknowledgements

reliable multicast

additional checksum to verify payload

\subsubsection{Message}

%figure message package

\begin{figure}[htbp]
    \centering
        \includegraphics[width=.9\textwidth]{figures/message.pdf}
    \caption{caption}
    \label{fig:figures_announcement}
\end{figure}


\begin{lstlisting}
final class Announcement {

	static final byte MESSAGE = 1;
	static final byte ACK = 2;
	static final byte NACK = 4;

	static final int HEADER_SIZE = 19;
	static final int MAX_MESSAGE_SIZE = 32768; //2^15
	static final int MAX_PAYLOAD_SIZE = MAX_MESSAGE_SIZE - HEADER_SIZE;

	private byte command;
	private int peerID;
	private int messageID;
	private long checksum;
	private short length;
	private byte[] payload = new byte[0];
}
\end{lstlisting}


\begin{figure}[htbp]
    \centering
        \includegraphics[height=4in]{figures/receivePackets.pdf}
    \caption{Message}
    \label{fig:figures_processReceivePackage}
\end{figure}

\begin{figure}[htbp]
    \centering
        \includegraphics[height=4in]{figures/processMessages.pdf}
    \caption{caption}
    \label{fig:figures_processMessages}
\end{figure}



\subsubsection{Optimizations}

limit bandwidth 
    - should be made dynamic
    
queue optimizations (discard duplicate)

\subsection{Logic}


\subsection{Interface}